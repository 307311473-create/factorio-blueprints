<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Factorio è“å›¾åº“ - ä¸€é”®å¤åˆ¶å»ºé€ </title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f9f9f9;
      color: #333;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 20px;
    }
    .search-box {
      display: flex;
      margin-bottom: 20px;
    }
    #searchInput {
      flex: 1;
      padding: 12px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 6px 0 0 6px;
      outline: none;
    }
    .search-btn {
      padding: 12px 20px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 0 6px 6px 0;
      cursor: pointer;
      font-size: 16px;
    }
    .search-btn:hover {
      background: #0056b3;
    }
    .result {
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .result h3 {
      margin-top: 0;
      color: #0066cc;
    }
    .result p {
      margin: 8px 0;
      line-height: 1.5;
    }
    .copy-btn {
      background: #28a745;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      margin-top: 8px;
    }
    .copy-btn:hover {
      background: #218838;
    }
    .empty {
      text-align: center;
      color: #666;
      padding: 40px 0;
    }
    .loading {
      text-align: center;
      padding: 20px;
      color: #555;
    }
    @media (max-width: 600px) {
      .search-box { flex-direction: column; }
      .search-btn { border-radius: 6px; margin-top: 8px; }
    }
  </style>
</head>
<body>
  <h1>ğŸ” Factorio è“å›¾åº“</h1>
  <div class="search-box">
    <input type="text" id="searchInput" placeholder="è¾“å…¥å…³é”®è¯ï¼ˆå¦‚ é½¿è½®ã€ç”µè·¯ã€é“€...ï¼‰" />
    <button class="search-btn">æœç´¢</button>
  </div>
  <div id="results" class="loading">æ­£åœ¨åŠ è½½è“å›¾æ•°æ®...</div>

  <script>
    let blueprints = [];

    // åŠ è½½è“å›¾æ•°æ®
    fetch('blueprints.json')
      .then(response => {
        if (!response.ok) throw new Error('æ— æ³•åŠ è½½ blueprints.json');
        return response.json();
      })
      .then(data => {
        blueprints = data;
        document.getElementById('results').innerHTML = '<div class="empty">è¯·è¾“å…¥å…³é”®è¯å¼€å§‹æœç´¢</div>';
      })
      .catch(err => {
        document.getElementById('results').innerHTML = `<div class="empty" style="color:red">âŒ ${err.message}</div>`;
      });

    // æœç´¢å‡½æ•°
    function performSearch(query) {
      const resultsDiv = document.getElementById('results');
      if (!query.trim()) {
        resultsDiv.innerHTML = '<div class="empty">è¯·è¾“å…¥å…³é”®è¯å¼€å§‹æœç´¢</div>';
        return;
      }

      const q = query.toLowerCase();
      const filtered = blueprints.filter(bp =>
        (bp.name && bp.name.toLowerCase().includes(q)) ||
        (bp.description && bp.description.toLowerCase().includes(q)) ||
        (bp.tags && bp.tags.some(tag => tag.toLowerCase().includes(q)))
      );

      if (filtered.length === 0) {
        resultsDiv.innerHTML = '<div class="empty">æœªæ‰¾åˆ°åŒ¹é…çš„è“å›¾ ğŸ˜¢</div>';
        return;
      }

      resultsDiv.innerHTML = filtered.map(bp => `
        <div class="result">
          <h3>${bp.name || 'æ— æ ‡é¢˜'}</h3>
          <p><strong>æè¿°ï¼š</strong>${bp.description || 'æ— æè¿°'}</p>
          <p><strong>æ ‡ç­¾ï¼š</strong>${bp.tags ? bp.tags.join(', ') : 'æ— '}</p>
          <p><strong>ç‰ˆæœ¬ï¼š</strong>${bp.factorio_version || 'æœªçŸ¥'}</p>
          <button class="copy-btn" onclick="copyBlueprint('${bp.code.replace(/'/g, "\\'")}')">
            ğŸ“‹ å¤åˆ¶è“å›¾ä»£ç ï¼ˆç²˜è´´åˆ°æ¸¸æˆï¼‰
          </button>
        </div>
      `).join('');
    }

    // å¤åˆ¶å‡½æ•°
    function copyBlueprint(code) {
      navigator.clipboard.writeText(code).then(() => {
        alert('âœ… è“å›¾ä»£ç å·²å¤åˆ¶ï¼\n\nåœ¨æ¸¸æˆä¸­æŒ‰ Shift + å·¦é”® å³å¯ç²˜è´´å»ºé€ ã€‚');
      }).catch(err => {
        console.error('å¤åˆ¶å¤±è´¥:', err);
        alert('âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ä»£ç ã€‚');
      });
    }

    // ç»‘å®šæœç´¢äº‹ä»¶
    const input = document.getElementById('searchInput');
    const button = document.querySelector('.search-btn');

    input.addEventListener('input', (e) => performSearch(e.target.value));
    button.addEventListener('click', () => performSearch(input.value));
  </script>
</body>
</html>
